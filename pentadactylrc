set runtimepath=$HOME/.pentadactyl
"" {{{ Option
set titlestring=Mozilla\ Firefox

" complete search engine suguest
set complete=location,suggestion

set guioptions=CBTbr

"set editor=vim

" Use home row letters for hints instead of numbers
set hintkeys='sadfjklewcmpgh'

" only follow hints when press enter
set followhints=1

" Show destination links in 1=status line, 2=command line
set showstatuslinks=command

" open things at new tab
set newtab=all

" set wild mode to show completions as you type
set wildmode="list:full"

" allow popups popup
"set popups=tab,resized

" only show the tab bar when there are multiple tabs
"set showtabline=multitab

" highlight the terms
set hlfind

" find as you type
set incfind

"" only consider case if an upper case char is used
set findcase=smart

" turn off the freakin' bell
hi Bell display: none;

colorscheme vimium
"" }}}
"" {{{ Mapping
set mapleader=','
" unset maps
nmap w <Nop>
nmap d <Nop>
nmap u <Nop>

" auto add -tags option when adding bookmark
nnoremap a a<Space>-tags<Space>

" move
nnoremap u 10k
nnoremap d 10j
nnoremap j 3j
nnoremap k 3k

nnoremap J :tabprevious<CR>
nnoremap K :tabnext<CR>
nnoremap x :quit<CR>
nnoremap X :undo<CR>

map <Leader>/ :set hlf!<CR>

" open addons manager
nnoremap <Leader>a :dialog addons<CR>

" private mode
nnoremap <Leader>p :set private!<CR>

" display download
nnoremap <Leader>d :downloads<CR>

" rehash
nnoremap <Leader>R :rehash<CR>

"" U list closed tabs
nnoremap U :undo<Space>

" bring back/hide portions of the GUI
noremap <silent> <leader>g :set guioptions=CBTbr<CR>
noremap <silent> <leader>G :set guioptions=Csb<CR>

" temporary workaround for copy paste in text boxes
" https://code.google.com/p/dactyl/issues/detail?id=517
inoremap <C-a> <pass>
inoremap <C-c> <pass>
inoremap <C-v> <pass>
inoremap <C-x> <pass>
"" }}}
"" {{{ Searching
"" from http://www.slimeden.com/2011/03/firefox/pentadactyl
":map t -js content.getSelection().toString()!=""?dactyl.execute(":tabopen "+ content.getSelection()):CommandExMode().open("tabopen ")
":map o -js content.getSelection().toString()!=""?dactyl.execute(":open "+ content.getSelection()):CommandExMode().open("open ")
command! -nargs=* -complete=search search execute 'tabopen <args> ' + content.getSelection().toString()
map s :search<Space>
command! -nargs=? -complete=search switchSearch execute 'open <args> ' + (buffer.lastInputField?buffer.lastInputField.value:'')
map S gi<ESC> :switchSearch<Space>
command! -nargs=* siteSearch execute "tabopen <args> site:" + window.content.location.hostname

"" hide all browser search engines except Google(for suggestion)
"js services.browserSearch.getEngines().forEach(function (e) {if(e.name!="Google") e.hidden = true})

"Searching: use DuckDuckGo
set defsearch=duckduckgo
"" }}}
"" {{{ Bookmarks
"" search engines
silent bma -tags searchengine -title='ArchLinux AUR' http://aur.archlinux.org/packages.php?O=0&L=0&C=0&K=%s&SeB=nd&PP=25 -k=aur
silent bma -tags searchengine -title='ArchLinux Wiki' http://wiki.archlinux.org/index.php?search=%s -k=archlinuxwiki
silent bma -tags searchengine -title='DeviantART' http://browse.deviantart.com/?qh=&section=&q=%s -k=deviantart
silent bma -tags searchengine -title='DuckDuckGo' https://duckduckgo.com/?q=%s -keyword duckduckgo
silent bma -tags searchengine -title='ThePirateBay' http://thepiratebay.org/search/%s -k=piratebay
silent bma -tags searchengine -title='Thesaurus' http://thesaurus.reference.com/the?q=%s -keyword=thesaurus
silent bma -tags searchengine -title='Youtube' http://www.youtube.com/results?search_query=%s -keyword=youtube
" Default Firefox Search Engines
"silent bma -tags searchengine -title='Google Search' https://www.google.com/search?q=%s -keyword google
"silent bma -tags searchengine -title='Twitter' https://twitter.com/search/%s -keyword twitter
"silent bma -tags searchengine -title='Wikipedia' http://en.wikipedia.org/wiki/Special:Search?search=%s -keyword wikipedia
"" misc
"silent bma -title='Router' http://192.168.1.1 -k=router
"" }}}
"" {{{ Bookmarklet
nnoremap <Leader>b :bml-
nnoremap <Leader>s :bml-subscribe<CR>
command! bml-readable -description "Bookmarklet: Make webpage readable" open javascript:(function(){_readableOptions={'text_font':'Vollkorn','text_font_monospace':'quote(Courier%20New),%20Courier,%20monospace','text_font_header':'quote(Palatino%20Linotype),%20Palatino,%20quote(Book%20Antigua),%20Georgia,%20serif','text_size':'20px','text_line_height':'1.5','box_width':'35em','color_text':'#282828','color_background':'#E5DED6','color_links':'#EE4545','text_align':'normal','base':'blueprint','custom_css':''};if(document.getElementsByTagName('body').length>0);else{return;}if(window.$readable){if(window.$readable.bookmarkletTimer){return;}}else{window.$readable={};}window.$readable.bookmarkletTimer=true;window.$readable.options=_readableOptions;if(window.$readable.bookmarkletClicked){window.$readable.bookmarkletClicked();return;}_readableScript=document.createElement('script');_readableScript.setAttribute('src','http://readable-static.tastefulwords.com/target.js?rand='+encodeURIComponent(Math.random()));document.getElementsByTagName('body')[0].appendChild(_readableScript);})()
command! bml-page2rss -description "Bookmarklet: Turn any page to RSS" open javascript:(function(){if(!window.page2rss_bookmark_urlr)window.page2rss_bookmark_urlr=function(ur){if(ur.error)alert(ur.error);if(ur.page&&ur.page.page)location.href=ur.page.page};var%20r=document.getElementById('urlFormRequest');if(r)r.parentNode.removeChild(r);r=document.createElement('script');r.id='urlFormRequest';r.type='text/javascript';r.src='http://page2rss.com/api/page?url='+encodeURIComponent(location.href)+'&callback=page2rss_bookmark_urlr';document.body.appendChild(r);})();
command! bml-share -description "Bookmarklet: Google reader official bookmarklet" open javascript:var%20b=document.body;var%20GR________bookmarklet_domain='http://www.google.com';if(b&&!document.xmlVersion){void(z=document.createElement('script'));void(z.src='http://www.google.com/reader/ui/link-bookmarklet.js');void(b.appendChild(z));}else{}
command! bml-subscribe -description "Bookmarklet: Subscribe using Google reader" open javascript:var%20b=document.body;var%20GR________bookmarklet_domain='http://www.google.com';if(b&&!document.xmlVersion){void(z=document.createElement('script'));void(z.src='http://www.google.com/reader/ui/subscribe-bookmarklet.js');void(b.appendChild(z));}else{location='http://www.google.com/reader/view/feed/'+encodeURIComponent(location.href)}
command! bml-twitter -description "Bookmarklet: Share on Twitter" open javascript:(function(){window.twttr=window.twttr||{};var%20D=550,A=450,C=screen.height,B=screen.width,H=Math.round((B/2)-(D/2)),G=0,F=document,E;if(C>A){G=Math.round((C/2)-(A/2))}window.twttr.shareWin=window.open('http://twitter.com/share','','left='+H+',top='+G+',width='+D+',height='+A+',personalbar=0,toolbar=0,scrollbars=1,resizable=1');E=F.createElement('script');E.src='http://platform.twitter.com/bookmarklets/share.js?v=1';F.getElementsByTagName('head')[0].appendChild(E)}());
command! bml-readability -description "Bookmarklet: Make webpage readable using readability" open javascript:(%28function%28%29%7Bwindow.baseUrl%3D%27http%3A//www.readability.com%27%3Bwindow.readabilityToken%3D%27%27%3Bvar%20s%3Ddocument.createElement%28%27script%27%29%3Bs.setAttribute%28%27type%27%2C%27text/javascript%27%29%3Bs.setAttribute%28%27charset%27%2C%27UTF-8%27%29%3Bs.setAttribute%28%27src%27%2CbaseUrl%2B%27/bookmarklet/read.js%27%29%3Bdocument.documentElement.appendChild%28s%29%3B%7D%29%28%29)
command! bml-valid -description "Bookmarklet: Validate site" open javascript:void(location='http://validator.w3.org/check?uri='+escape(location))
command! bml-firebug -description "Bookmarklet: Open Firebug" open javascript:(function(F,i,r,e,b,u,g,L,I,T,E){if(F.getElementById(b))return;E=F[i+'NS']&&F.documentElement.namespaceURI;E=E?F[i+'NS'](E,'script'):F[i]('script');E[r]('id',b);E[r]('src',I+g+T);E[r](b,u);(F[e]('head')[0]||F[e]('body')[0]).appendChild(E);E=new%20Image;E[r]('src',I+L);})(document,'createElement','setAttribute','getElementsByTagName','FirebugLite','4','firebug-lite.js','releases/lite/latest/skin/xp/sprite.png','https://getfirebug.com/','#startOpened');
command! bml-ghfinder -description "Bookmarklet: Open any Github repo in GHFinder" open javascript:(function(){var%20a=(new%20RegExp("github.com/(.+)","i")).exec(window.location.href);var%20f=a?a[1].split("/"):[];var%20b=f[0];var%20d=f[1];var%20e=f[3];var%20c="http://sr3d.github.com/GithubFinder/?utm_source=bml"+(a?"&user_id="+b+"&repo="+d+(e?"&branch="+e:""):"");if(!c){alert("Invalid%20Github%20URL");return}window.open(c)})()
command! bml-cookie-injection -description "Bookmarklet: Cookie injection" open javascript:hf=location.hostname;%20if(hf=="4shared.com"||hf=="www.4shared.com"){coo="PHPSESSID";dom=".4shared.com";}%20else%20if(hf=="alldebrid.com"||hf=="www.alldebrid.com"){coo="uid";dom=".alldebrid.com";}%20else%20if(hf=="alldebrid.org"||hf=="www.alldebrid.org"){coo="uid";dom=".alldebrid.org";}%20else%20if(hf=="crocko.com"||hf=="www.crocko.com"){coo="PHPSESSID";dom=".crocko.com";}%20else%20if(hf=="debridmax.com"||hf=="www.debridmax.com"){coo="PHPSESSID";dom=".www.debridmax.com";}%20else%20if(hf=="depositfiles.com"||hf=="www.depositfiles.com"){coo="autologin";dom=".depositfiles.com";}%20else%20if(hf=="fast-debrid.com"||hf=="www.fast-debrid.com"){coo="PHPSESSID";dom=".www.fast-debrid.com";}%20else%20if(hf=="fileape.com"||hf=="www.fileape.com"){coo="usr_id";dom=".fileape.com";}%20else%20if(hf=="filefactory.com"||hf=="www.filefactory.com"){coo="ff_membership";dom=".filefactory.com";}%20else%20if(hf=="filepost.com"||hf=="www.filepost.com"){coo="ff_membership";dom=".filepost.com";}%20else%20if(hf=="fileserve.com"||hf=="www.fileserve.com"){coo="cookie";dom=".fileserve.com";}%20else%20if(hf=="filesmonster.com"||hf=="www.filesmonster.com"){coo="ff_membership";dom=".filesmonster.com";}%20else%20if(hf=="filesonic.com"||hf=="www.filesonic.com"){coo="PHPSESSID";dom=".filesonic.com";}%20else%20if(hf=="filesonic.in"||hf=="www.filesonic.in"){coo="PHPSESSID";dom=".filesonic.in";}%20else%20if(hf=="hotfile.com"||hf=="www.hotfile.com"){coo="auth";dom=".hotfile.com";}%20else%20if(hf=="letitbit.net"||hf=="www.letitbit.net"){coo="auth";dom=".letitbit.net";}%20else%20if(hf=="mediafire.com"||hf=="www.mediafire.com"){coo="PHPSESSID";dom=".mediafire.com";}%20else%20if(hf=="mega-debrid.eu"||hf=="www.mega-debrid.eu"){coo="PHPSESSID";dom=".www.mega-debrid.eu";}%20else%20if(hf=="netload.in"||hf=="www.netload.in"){coo="cookie_user";dom=".netload.in";}%20else%20if(hf=="oron.com"||hf=="www.oron.com"){coo="xfss";dom=".oron.com";}%20else%20if(hf=="rapidshare.com"||hf=="www.rapidshare.com"){coo="enc";dom=".rapidshare.com";}%20else%20if(hf=="real-debrid.com"||hf=="www.real-debrid.com"){coo="auth";dom=".real-debrid.com";}%20else%20if(hf=="turbobit.net"||hf=="www.turbobit.net"){coo="kohanasession";dom=".turbobit.net";}%20else%20if(hf=="uploaded.to"||hf=="www.uploaded.to"){coo="login";dom=".uploaded.to";}%20else%20if(hf=="uploading.com"||hf=="www.uploading.com"){coo="SID";dom=".uploading.com";}%20else%20if(hf=="uploadstation.com"||hf=="www.uploadstation.com"){coo="PHPSESSID";dom=".uploadstation.com";}%20else%20if(hf=="wupload.com"||hf=="www.wupload.com"){coo="PHPSESSID";dom=".wupload.com";}%20else%20if(hf=="wupload.com.br"||hf=="www.wupload.com.br"){coo="PHPSESSID";dom=".wupload.com";}%20else%20{alert("Site%20not%20supported%20please%20try%20again!")+fonction.close;}%20c=prompt("Enter%20a%20cookie%20on%20"+hf+"","");%20if(c!==""||c!==null+fonction.close)%20if(c!==""||c!==null+fonction.close)if(c.length%20<%2070%20&&%20hf=="uploaded.to"){coo="PHPSESSID";dom=".uploaded.to";}%20if(hf=="crocko.com"){var%20cookies%20=%20new%20Array();cookies['+com+']%20=%20'+c+';cookies['logacc']%20=%20'1';}%20else%20if(hf=="netload.in"||hf=="www.netload.in"){var%20cookies%20=%20new%20Array();cookies['+com+']%20=%20'+c+';cookies['cookie_user']%20=%20'325572%3A%241%24n4LTphFB%24Xek.JojOoMlEThLEIoTuH0';}%20else%20if(hf=="fileape.com"||hf=="www.fileape.com"){var%20cookies%20=%20new%20Array();cookies['+com+']%20=%20'+c+';cookies['usr_session_ident']%20=%20'828ba353d0c80e03696e9f08a65a488d';}%20else%20{var%20cookies%20=%20new%20Array();cookies['+com+']%20=%20'+c+';}%20if(c!==""||c!==null+fonction.close){r=d=new%20Date();nd=new%20Date(d.getFullYear()+2,2%20,11);%20for(var%20i%20in%20cookies){void(document.cookie%20=%20i+'='+cookies[i]+';domain=.'+dom+';path=/;'+(r?'expires='+nd:''));}location.reload(true);}
"" }}}
"" {{{ Command
"" smart reload
command! smartReload -js <<EOF
if (buffer.URL.spec.indexOf('#') >= 0) {
    dactyl.execute("reload");
} else {
    dactyl.open(buffer.URL.spec);
}
EOF
nnoremap r :smartReload<CR>

command! smartReader -js <<EOF
if (typeof __readable_by_evernote === "object") {
    dactyl.execute("emenu Tools.Clearly");
} else if (typeof FirefoxReader === "object") {
    dactyl.execute("feedkeys <M-A-z>");
} else if (typeof commands.get("readability") === "object") {
    dactyl.execute("readability");
} else {
    dactyl.execute("bml-readability");
}
EOF
nnoremap <Leader>r :smartReader<CR>

"" reload .pentadactylrc
command! fresh -description "Reload .pentadactylrc file" source $HOME/.pentadactylrc

"" set title to url
"autocmd! LocationChange .* :set titlestring=<url>

"" enable pass through mode on all google sites
autocmd LocationChange www.google.com,mail.google.com :normal! <C-z>
"" }}}
